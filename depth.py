import numpy as np

# Devices.
CV_CAP_OPENNI = 900  # OpenNI (for Microsoft Kinect)
CV_CAP_OPENNI_ASUS = 910  # OpenNI (for Asus Xtion)
CV_CAP_LENOVO_DEPTH_CAM = 1  # Lenovo inbuilt depth cam.
# Channels of an OpenNI-compatible depth generator.
CV_CAP_OPENNI_DEPTH_MAP = 0  # Depth values in mm (CV_16UC1)
CV_CAP_OPENNI_POINT_CLOUD_MAP = 1  # XYZ in meters (CV_32FC3)
CV_CAP_OPENNI_DISPARITY_MAP = 2  # Disparity in pixels (CV_8UC1)
CV_CAP_OPENNI_DISPARITY_MAP_32F = 3  # Disparity in pixels (CV_32FC1)
CV_CAP_OPENNI_VALID_DEPTH_MASK = 4  # CV_8UC1
# Channels of an OpenNI-compatible RGB image generator.
CV_CAP_OPENNI_BGR_IMAGE = 5
CV_CAP_OPENNI_GRAY_IMAGE = 6


def createMedianMask(disparityMap, validDepthMask, rect=None):
    """Return a mask selecting the median layer, plus shadows."""
    if rect is not None:
        x, y, w, h = [int(i) for i in rect]
        disparityMap = disparityMap[y:y + h, x:x + w]
        validDepthMask = validDepthMask[y:y + h, x:x + w]

    median = np.median(disparityMap)
    return np.where((validDepthMask == 0) | (abs(disparityMap - median) < 12),
                    1.0, 0.0)
